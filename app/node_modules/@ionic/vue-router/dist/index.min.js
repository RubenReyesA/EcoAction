import{parseQuery as e,createRouter as t,createWebHistory as n,createWebHashHistory as r,createMemoryHistory as o}from"vue-router";import{shallowRef as i}from"vue";const a={main:0},s=(e="main")=>{var t;const n=(null!==(t=a[e])&&void 0!==t?t:0)+1;return a[e]=n,n.toString()},u=(t,n)=>{let r={direction:void 0,action:void 0};n.afterEach(((e,t,n)=>{if(n)return;const{direction:o,action:i}=r,a=history.state.replaced?"replace":void 0;f(e,i||a,o),r={direction:void 0,action:void 0}}));const o=(()=>{const e=[],t={},n=t=>{const n=a(t.tab);n&&n.pop(),e.pop(),o(t)},r=t=>{const n=a(t.tab);let r;if(n){for(r=n[n.length-1];r&&r.id!==t.id;)n.pop(),r=n[n.length-1];n.pop(),n.push(t)}for(r=e[e.length-1];r&&r.id!==t.id;)e.pop(),r=e[e.length-1];e.pop(),e.push(t)},o=t=>{const n=a(t.tab);n&&(n[n.length-1]&&n[n.length-1].id===t.id&&n.pop(),n.push(t)),e.push(t)},i=()=>{e.length=0,Object.keys(t).forEach((e=>{t[e]=[]}))},a=e=>{let n;return e&&(n=t[e],n||(n=t[e]=[])),n},s=()=>e[e.length-1];return{current:s,previous:()=>e[e.length-2]||s(),add:e=>{switch(e.routerAction){case"replace":n(e);break;case"pop":r(e);break;default:o(e)}"root"===e.routerDirection&&(i(),o(e))},canGoBack:(t=1)=>e.length>t,update:n=>{const r=e.findIndex((e=>e.id===n.id));r>-1&&e.splice(r,1,n);const o=t[n.tab||""];if(o){const e=o.findIndex((e=>e.id===n.id));e>-1?o.splice(e,1,n):o.push(n)}else n.tab&&(t[n.tab]=[n])},getFirstRouteInfoForTab:e=>{const t=a(e);if(t)return t[0]},getCurrentRouteInfoForTab:e=>{const t=a(e);if(t)return t[t.length-1]},findLastLocation:t=>{const n=a(t.tab);if(n)for(let e=n.length-2;e>=0;e--){const r=n[e];if(r&&r.pathname===t.pushedByRoute)return r}for(let n=e.length-2;n>=0;n--){const r=e[n];if(r&&r.pathname===t.pushedByRoute)return r}}}})();let i,a,u,c=[];"undefined"!=typeof document&&document.addEventListener("ionBackButton",(e=>{e.detail.register(0,(e=>{t.history.go(-1),e()}))})),t.history.listen(((e,t,n)=>{r={action:n.type,direction:""===n.direction?"forward":n.direction}}));const p=(e,t,r,o,i)=>{a={routerAction:t,routerDirection:r,routerAnimation:o,tab:i},"push"===t?n.push(e):n.replace(e)},f=(e,t,n)=>{let r;r=a&&"replace"===a.routerAction?o.previous():o.current(),r||(r={pathname:"",search:""});if(r.pathname+r.search!==e.fullPath){if(!a){if("replace"===t)a={routerAction:"replace",routerDirection:"none",tab:u};else if("pop"===t){const e=o.current();if(e&&e.pushedByRoute){const t=o.findLastLocation(e);a=Object.assign(Object.assign({},t),{routerAction:"pop",routerDirection:"back"})}else a={routerAction:"pop",routerDirection:"none",tab:u}}a||(a={routerAction:"push",routerDirection:n||"forward",tab:u})}let c;if(null==a?void 0:a.id)c=Object.assign(Object.assign({},a),{lastPathname:r.pathname}),o.add(c);else{const t="push"===a.routerAction&&"forward"===a.routerDirection;if(c=Object.assign(Object.assign({id:s("routeInfo")},a),{lastPathname:r.pathname,pathname:e.path,search:e.fullPath&&e.fullPath.split("?")[1]||"",params:e.params&&e.params}),t)c.tab=r.tab,c.pushedByRoute=""!==r.pathname?r.pathname:void 0;else if("pop"===c.routerAction){const e=o.findLastLocation(c);c.pushedByRoute=null==e?void 0:e.pushedByRoute}else if("push"===c.routerAction&&c.tab!==r.tab){const e=o.getCurrentRouteInfoForTab(c.tab);c.pushedByRoute=null==e?void 0:e.pushedByRoute}else if("replace"===c.routerAction){const e=o.current();c.lastPathname=(null==e?void 0:e.pathname)||c.lastPathname,c.pushedByRoute=(null==e?void 0:e.pushedByRoute)||c.pushedByRoute,c.routerDirection=(null==e?void 0:e.routerDirection)||c.routerDirection,c.routerAnimation=(null==e?void 0:e.routerAnimation)||c.routerAnimation}o.add(c)}i=c}a=void 0,c.forEach((e=>e(i)))};return{handleNavigateBack:(t,r)=>{const i=o.current();if(i&&i.pushedByRoute){const s=o.findLastLocation(i);s?(a=Object.assign(Object.assign({},s),{routerAction:"pop",routerDirection:"back",routerAnimation:r||i.routerAnimation}),i.lastPathname===i.pushedByRoute?n.back():n.replace({path:s.pathname,query:e(s.search)})):p(t,"pop","back")}else p(t,"pop","back")},handleSetCurrentTab:e=>{u=e;const t=Object.assign({},o.current());t.tab!==e&&(t.tab=e,o.update(t))},getCurrentRouteInfo:()=>i,canGoBack:(e=1)=>o.canGoBack(e),navigate:e=>{const{routerAnimation:t,routerDirection:r,routerLink:o}=e;a={routerAnimation:t,routerDirection:r||"forward",routerAction:"push"},n.push(o)},resetTab:(t,r)=>{const i=o.getFirstRouteInfoForTab(t);if(i){const t=Object.assign({},i);t.pathname=r,a=Object.assign(Object.assign({},t),{routerAction:"pop",routerDirection:"back"}),n.push({path:t.pathname,query:e(t.search)})}},changeTab:(t,r)=>{const i=o.getCurrentRouteInfoForTab(t),[s]=r.split("?");i?(a=Object.assign(Object.assign({},a),{routerAction:"push",routerDirection:"none",tab:t}),i.pathname===s?n.push({path:i.pathname,query:e(i.search)}):n.push({path:s,query:e(i.search)})):p(s,"push","none",void 0,t)},registerHistoryChangeListener:e=>{c.push(e)}}};function c(e,t={}){const n=function(e){const t=[];let n=0;for(;n<e.length;){const r=e[n];if("*"!==r&&"+"!==r&&"?"!==r)if("\\"!==r)if("{"!==r)if("}"!==r)if(":"!==r)if("("!==r)t.push({type:"CHAR",index:n,value:e[n++]});else{let r=1,o="",i=n+1;if("?"===e[i])throw new TypeError('Pattern cannot start with "?" at '+i);for(;i<e.length;)if("\\"!==e[i]){if(")"===e[i]){if(r--,0===r){i++;break}}else if("("===e[i]&&(r++,"?"!==e[i+1]))throw new TypeError("Capturing groups are not allowed at "+i);o+=e[i++]}else o+=e[i++]+e[i++];if(r)throw new TypeError("Unbalanced pattern at "+n);if(!o)throw new TypeError("Missing pattern at "+n);t.push({type:"PATTERN",index:n,value:o}),n=i}else{let r="",o=n+1;for(;o<e.length;){const t=e.charCodeAt(o);if(!(t>=48&&t<=57||t>=65&&t<=90||t>=97&&t<=122||95===t))break;r+=e[o++]}if(!r)throw new TypeError("Missing parameter name at "+n);t.push({type:"NAME",index:n,value:r}),n=o}else t.push({type:"CLOSE",index:n,value:e[n++]});else t.push({type:"OPEN",index:n,value:e[n++]});else t.push({type:"ESCAPED_CHAR",index:n++,value:e[n++]});else t.push({type:"MODIFIER",index:n,value:e[n++]})}return t.push({type:"END",index:n,value:""}),t}(e),{prefixes:r="./"}=t,o=`[^${p(t.delimiter||"/#?")}]+?`,i=[];let a=0,s=0,u="";const c=e=>{if(s<n.length&&n[s].type===e)return n[s++].value},f=e=>{const t=c(e);if(void 0!==t)return t;const{type:r,index:o}=n[s];throw new TypeError(`Unexpected ${r} at ${o}, expected ${e}`)},d=()=>{let e,t="";for(;e=c("CHAR")||c("ESCAPED_CHAR");)t+=e;return t};for(;s<n.length;){const e=c("CHAR"),t=c("NAME"),n=c("PATTERN");if(t||n){let s=e||"";-1===r.indexOf(s)&&(u+=s,s=""),u&&(i.push(u),u=""),i.push({name:t||a++,prefix:s,suffix:"",pattern:n||o,modifier:c("MODIFIER")||""});continue}const s=e||c("ESCAPED_CHAR");if(s){u+=s;continue}u&&(i.push(u),u="");if(c("OPEN")){const e=d(),t=c("NAME")||"",n=c("PATTERN")||"",r=d();f("CLOSE"),i.push({name:t||(n?a++:""),pattern:t&&!n?o:n,prefix:e,suffix:r,modifier:c("MODIFIER")||""})}else f("END")}return i}function p(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function f(e){return e&&e.sensitive?"":"i"}function d(e,t,n){return function(e,t,n={}){const{strict:r=!1,start:o=!0,end:i=!0,encode:a=(e=>e)}=n,s=`[${p(n.endsWith||"")}]|$`,u=`[${p(n.delimiter||"/#?")}]`;let c=o?"^":"";for(const n of e)if("string"==typeof n)c+=p(a(n));else{const e=p(a(n.prefix)),r=p(a(n.suffix));if(n.pattern)if(t&&t.push(n),e||r)if("+"===n.modifier||"*"===n.modifier){const t="*"===n.modifier?"?":"";c+=`(?:${e}((?:${n.pattern})(?:${r}${e}(?:${n.pattern}))*)${r})${t}`}else c+=`(?:${e}(${n.pattern})${r})${n.modifier}`;else c+=`(${n.pattern})${n.modifier}`;else c+=`(?:${e}${r})${n.modifier}`}if(i)r||(c+=u+"?"),c+=n.endsWith?`(?=${s})`:"$";else{const t=e[e.length-1],n="string"==typeof t?u.indexOf(t[t.length-1])>-1:void 0===t;r||(c+=`(?:${u}(?=${s}))?`),n||(c+=`(?=${u}|${s})`)}return new RegExp(c,f(n))}(c(e,n),t,n)}function l(e,t,n){return e instanceof RegExp?function(e,t){if(!t)return e;const n=/\((?:\?<(.*?)>)?(?!\?)/g;let r=0,o=n.exec(e.source);for(;o;)t.push({name:o[1]||r++,prefix:"",suffix:"",modifier:"",pattern:""}),o=n.exec(e.source);return e}(e,t):Array.isArray(e)?function(e,t,n){const r=e.map((e=>l(e,t,n).source));return new RegExp(`(?:${r.join("|")})`,f(n))}(e,t,n):d(e,t,n)}const h=e=>{const n=Object.assign({},e);delete n.tabsPrefix;const r=t(n),o=u(e,r),a=(()=>{let e={};const t=(e,t)=>t.find((t=>{if(t.pathname===e)return t})),n=(n,r,o=!0)=>{const i=e=>{const t=n;return l(e.matchedRoute.path,[],{end:e.exact,strict:e.exact,sensitive:!1}).exec(t)?e:void 0};if(r){const a=e[r];if(!a)return;const s=t(n,a);if(s)return s;if(!o){const e=a.find(i);if(e)return e}}else for(let r in e){const o=e[r],i=t(n,o);if(i)return i}};return{clear:t=>{delete e[t]},findViewItemByRouteInfo:(e,t)=>n(e.pathname,t),findLeavingViewItemByRouteInfo:(e,t)=>n(e.lastPathname,t,!1),createViewItem:(e,t,n,r,o)=>({id:s("viewItem"),pathname:r.pathname,outletId:e,matchedRoute:n,ionPageElement:o,vueComponent:t,vueComponentRef:i(),ionRoute:!1,mount:!1,exact:r.pathname===n.path,params:r.params,vueComponentData:{}}),getChildrenToRender:t=>e[t]?e[t].filter((e=>e.mount)):[],add:t=>{const{outletId:n}=t;e[n]?e[n].push(t):e[n]=[t]},remove:(t,n)=>{if(!n)throw Error("outletId required");const r=e[n];r&&(e[n]=r.filter((e=>e.id!==t.id)))},registerIonPage:(e,t)=>{e.ionPageElement=t},getViewStack:t=>e[t]}})(),c=r.install.bind(r);r.install=e=>{e.provide("navManager",o),e.provide("viewStacks",a),c(e)};const p=r.isReady.bind(r);return r.isReady=()=>p(),r},m=e=>n(e),g=e=>r(e),b=e=>o(e);export{b as createMemoryHistory,h as createRouter,g as createWebHashHistory,m as createWebHistory};
//# sourceMappingURL=index.min.js.map
